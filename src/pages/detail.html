<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Details</title>
  </head>
  <body class="bg-regal-blue overflow-x-hidden">
    <nav class="border-gray-200 px-7 sm:px-4 py-2.5 rounded dark:bg-gray-900">
      <div
        class="container flex flex-wrap justify-between items-center mx-auto"
      >
        <a href="" class="flex items-center">
          <img
            src="./../img/logo.png"
            class="mr-3 h-6 sm:h-9"
            alt="Flowbite Logo"
          />
          <span
            class="self-center text-xl font-semibold whitespace-nowrap text-white"
            >QTime DB</span
          >
        </a>
        <button
          id="hamburger"
          type="button"
          class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
          data-drawer-target="drawer-right-example"
          data-drawer-show="drawer-right-example"
          data-drawer-placement="right"
          aria-controls="drawer-right-example"
        >
          <span class="sr-only">Open main menu</span>
          <svg
            class="w-6 h-6"
            aria-hidden="true"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
        <div
          id="drawer-right-example"
          class="fixed z-40 h-screen p-4 overflow-y-auto bg-[#253355] w-80"
          tabindex="-1"
          aria-labelledby="drawer-right-label"
        >
          <button
            type="button"
            data-drawer-dismiss="drawer-right-example"
            aria-controls="drawer-right-example"
            class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 right-2.5 inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
          >
            <svg
              aria-hidden="true"
              class="w-5 h-5"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span class="sr-only">Close menu</span>
          </button>
          <ul
            class="flex bg-[#253355] lg:h-auto lg:bg-transparent flex-col p-4 h-screen mt-4 lg:flex-row lg:space-x-8 lg:justify-end lg:mt-0 lg:text-sm lg:font-medium md:border-0"
          >
            <li>
              <a class="block py-2 pr-4 pl-3 text-white rounded" href=""
                >Menu</a
              >
            </li>
            <li>
              <a href="#" class="block py-2 pr-4 pl-3 text-white rounded"
                >TV Shows</a
              >
            </li>
            <li>
              <a href="#" class="block py-2 pr-4 pl-3 text-white rounded"
                >Suggest me -></a
              >
            </li>
          </ul>
        </div>
        <div
          class="w-[85%] hidden xl:block left-[-23rem] top-[50px] absolute lg:relative lg:top-0 lg:left-[0] lg:right-0 lg:w-auto sm:left-[-34rem] md:left-[-41rem] xl:left-0 xl:w-auto navbar-default transition-all ease-in-out duration-[.4s]"
        >
          <ul
            class="flex bg-[#253355] lg:h-auto lg:bg-transparent flex-col p-4 h-screen mt-4 lg:flex-row lg:space-x-8 lg:justify-end lg:mt-0 lg:text-sm lg:font-medium md:border-0"
          >
            <li>
              <a class="block py-2 pr-4 pl-3 text-white rounded" href=""
                >Menu</a
              >
            </li>
            <li>
              <a href="#" class="block py-2 pr-4 pl-3 text-white rounded"
                >TV Shows</a
              >
            </li>
            <li>
              <a href="#" class="block py-2 pr-4 pl-3 text-white rounded"
                >Suggest me -></a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main>
      <div
        class="hero px-7 xl:px-[12.5rem] max-h-[20rem] sm:max-h-[30rem] xl:max-h-[40rem] h-[78vh] xl:h-[65vh] flex flex-col justify-center items-start text-white"
      >
        <div class="cover h-auto w-full rounded-3xl relative">
          <div class="item">
            <!-- <img
              class="h-[10rem] sm:h-[40vw] xl:h-[35rem] rounded-3xl"
              src="./../img/kny-large.jpg"
              alt=""
              srcset=""
            /> -->
            <iframe
              id="iframe"
              class="w-full h-full aspect-8/3 rounded-3xl"
              src=""
              title="YouTube video player"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
            <!-- <span
              class="bg-gradient-to-t from-[#362C92] to-[#126297] opacity-[40%] rounded-[40px] w-full h-full absolute bottom-0"
            ></span> -->
            <div
              class="frame w-[14rem] h-[75px] xl:w-[560px] xl:h-[144px] flex flex-col justify-center items-start pl-6 xl:pl-10 absolute xl:bottom-[-5rem] -bottom-10 left-3 xl:left-20 bg-cardMovies shadow-xl rounded-[24px]"
            >
              <div class="breadCrumb">
                <nav class="flex" aria-label="Breadcrumb">
                  <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                      <a
                        href="./../index.html"
                        class="inline-flex items-center text-[12px] xl:text-sm font-semibold text-breadcrumbs"
                      >
                        <svg
                          class="xl:w-4 xl:h-4 w-3 h-3 mr-2"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
                          ></path>
                        </svg>
                        Home
                      </a>
                    </li>
                    <li>
                      <div class="flex items-center">
                        <p class="text-[#8996A1] mr-1">
                          /
                        </p>
                        <a
                          id="media_type"
                          href="#"
                          class="ml-1 text-[12px] xl:text-sm font-semibold text-breadcrumbs"
                        ></a>
                      </div>
                    </li>
                  </ol>
                </nav>
              </div>
              <div class="detail-heading">
                <h1 id="dataId" class="text-[16px] xl:text-[32px]"></h1>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="wrapper-detail px-7 xl:px-0 mt-0 sm:mt-20 xl:mt-28 flex lg:flex-row flex-col justify-evenly w-full space-y-10 lg:space-y-0 xl:space-y-0"
      >
        <div class="detail-img">
          <img
            id="detailImg"
            class="xl:w-auto w-52 sm:w-80 m-auto xl:m-0"
            src=""
            alt=""
          />
        </div>
        <div
          class="detail-text w-auto lg:w-[480px] flex flex-col space-y-10 xl:space-y-0"
        >
          <div class="text__top">
            <h2
              id="top_tagline"
              class="text-[20px] xl:text-[24px] text-movieTitle font-bold"
            ></h2>
            <p
              id="top_overview"
              class="text-[16px] xl:text-[20px] font-normal text-sinopsis"
            ></p>
          </div>
          <div
            class="text__bot flex flex-col justify-evenly h-full space-y-5 xl:space-y-0 mb-10"
          >
            <div class="bot-type">
              <p class="text-detailSub text-[14px] xl:text-[16px]">Type</p>
              <p
                id="bot_type"
                class="text-detailSubVal text-[16px] xl:text-[20px]"
              ></p>
            </div>
            <div class="bot-release">
              <p class="text-detailSub text-[14px] xl:text-[16px]">
                Release Date:
              </p>
              <p
                id="bot_release"
                class="text-detailSubVal text-[16px] xl:text-[20px]"
              ></p>
            </div>
            <div class="bot-time">
              <p class="text-detailSub text-[14px] xl:text-[16px]">Run time</p>
              <p
                id="bot_runtime"
                class="text-detailSubVal text-[16px] xl:text-[20px]"
              ></p>
            </div>
            <div class="bot-genres">
              <p class="text-detailSub text-[14px] xl:text-[16px]">Genres</p>
              <p
                id="bot_genres"
                class="text-detailSubVal text-[16px] xl:text-[20px]"
              ></p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      let iframe = document.getElementById("iframe");
      const API_KEY = "0407909af3830d4ca4556ca68266735f";
      const API_VIDEP =
        "https://api.themoviedb.org/3/movie/{movie_id}/videos?api_key=<<api_key>>&language=en-US";
      // https://api.themoviedb.org/3/tv/{tv_id}?api_key=<<api_key>>&language=en-US
      // https://api.themoviedb.org/3/movie/{movie_id}?api_key=<<api_key>>&language=en-US
      let dataId = document.getElementById("dataId");
      let media_type = document.getElementById("media_type");
      let detailImg = document.getElementById("detailImg");
      let bot_type = document.getElementById("bot_type");
      let bot_release = document.getElementById("bot_release");
      let bot_runtime = document.getElementById("bot_runtime");
      let bot_genres = document.getElementById("bot_genres");
      let top_tagline = document.getElementById("top_tagline");
      let top_overview = document.getElementById("top_overview");
      let getId = JSON.parse(localStorage.getItem("dataTrending"));
      // dataId.innerHTML = getId[0].id;
      media_type.innerHTML = getId[0].media_type.toUpperCase();

      function getDataType() {
        if (media_type == "tv") {
          getDetail(getId[0].media_type);
          getVideo(getId[0].media_type);
          return;
        }
        getDetail(getId[0].media_type);
        getVideo(getId[0].media_type);
      }

      function getDetail(type) {
        return fetch(
          `https://api.themoviedb.org/3/${type}/${getId[0].id}?api_key=${API_KEY}&language=en-US`
        )
          .then((response) => response.json())
          .then((datas) => renderDetail(datas));
      }

      function getVideo(type) {
        return fetch(
          `https://api.themoviedb.org/3/${type}/${getId[0].id}/videos?api_key=${API_KEY}&language=en-US`
        )
          .then((response) => response.json())
          .then((datas) => renderVideo(datas.results));
      }

      function renderVideo(datas) {
        console.log(datas);
        const indexOf = datas.findIndex((x) => x.name === "Official Trailer");
        console.log(indexOf);
        if (indexOf == -1) {
          return (iframe.src = ` https://www.youtube.com/embed/${datas[0].key}`);
          // return (iframe.src = ` https://www.youtube.com/embed/${datas[0].key}`);
        }

        return (iframe.src = ` https://www.youtube.com/embed/${datas[indexOf].key}`);

        // console.log(datas[indexOf].key);
        // console.log(iframe.src);
      }

      function renderDetail(datas) {
        // console.log(datas);
        detailImg.src = `https://image.tmdb.org/t/p/w500${datas.poster_path}`;
        bot_type.innerHTML = getId[0].media_type.toUpperCase();
        top_tagline.innerHTML = datas.tagline;
        top_overview.innerHTML += datas.overview;
        if (
          datas.release_date == undefined &&
          datas.runtime == undefined &&
          datas.original_title == undefined
        ) {
          dataId.innerHTML = datas.name;
          bot_release.innerHTML = `${datas.first_air_date}`;
          bot_runtime.innerHTML = `${datas.last_episode_to_air.episode_number} Episode`;
        } else {
          dataId.innerHTML = datas.title;
          bot_release.innerHTML = `${datas.release_date}`;
          bot_runtime.innerHTML = `${datas.runtime} min`;
        }

        datas.genres.forEach((genre) => {
          bot_genres.innerHTML += ` ${genre.name} ,`;
        });
      }
      getDataType();
    </script>
    <script src="./../../dist/js/index.js"></script>
  </body>
</html>
